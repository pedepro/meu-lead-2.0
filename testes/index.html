<div class="imovel-cadastro">
    <h2>Cadastro de Imóvel</h2>
    <div class="form-container">
        <div>
            <label>Nome do Proprietário</label>
            <input type="text" name="nome_proprietario" placeholder="Digite o nome do proprietário">
        </div>
        <div>
            <label>Valor (R$)</label>
            <input type="number" name="valor" step="0.01" placeholder="Digite o valor">
        </div>
        <div>
            <label>Banheiros</label>
            <input type="number" name="banheiros" placeholder="Digite a quantidade de banheiros">
        </div>
        <div>
            <label>Metros Quadrados (m²)</label>
            <input type="number" name="metros_quadrados" placeholder="Digite a área em m²">
        </div>
        <div>
            <label>Andar</label>
            <input type="number" name="andar" placeholder="Digite o número do andar">
        </div>
        <div>
            <label>Mobiliado</label>
            <select name="mobiliado">
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
            </select>
        </div>
        <div>
            <label>Preço de Contato</label>
            <input type="text" name="price_contato" placeholder="Digite o preço de contato">
        </div>
        <div>
            <label>Vagas de Garagem</label>
            <input type="number" name="vagas_garagem" placeholder="Digite a quantidade de vagas">
        </div>
        <div>
            <label>Cidade</label>
            <select name="cidade">
                <option value="">Selecione uma cidade</option>
                <option value="São Paulo">São Paulo</option>
                <option value="Rio de Janeiro">Rio de Janeiro</option>
                <option value="Belo Horizonte">Belo Horizonte</option>
                <option value="Porto Alegre">Porto Alegre</option>
            </select>
        </div>
        <div>
            <label>Categoria</label>
            <input type="text" name="categoria" placeholder="Ex.: Residencial, Comercial">
        </div>
        <div>
            <label>Quartos</label>
            <input type="number" name="quartos" placeholder="Digite a quantidade de quartos">
        </div>
        <div>
            <label>Texto Principal</label>
            <input type="text" name="texto_principal" placeholder="Título principal do imóvel">
        </div>
        <div>
            <label>WhatsApp</label>
            <input type="text" name="whatsapp" placeholder="Digite o número com DDD">
        </div>
        <div>
            <label>Tipo</label>
            <select name="tipo" id="tipoSelect">
                <option value="">Selecione o tipo</option>
            </select>
        </div>
        <div>
            <label>Endereço</label>
            <input type="text" name="endereco" placeholder="Digite o endereço completo">
        </div>
        <div>
            <label>Descrição</label>
            <textarea name="descricao" placeholder="Descreva o imóvel"></textarea>
        </div>
        <div>
            <label>Descrição de Negociação</label>
            <textarea name="descricao_negociacao" placeholder="Detalhes sobre negociação"></textarea>
        </div>
        <div class="imagens-section">
            <label>Imagens</label>
            <input type="file" name="imagens" id="imagensInput" multiple accept="image/*">
            <div id="imagensPreview"></div>
        </div>
        <div>
            <button onclick="enviarCadastroImovel(event)">Cadastrar Imóvel</button>
        </div>
    </div>

    <style>
        .imovel-cadastro {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .imovel-cadastro h2 {
            color: #1A73E8;
            font-size: 24px;
            margin-bottom: 20px;
        }
        .form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .form-container > div {
            flex: 1;
            min-width: 250px;
        }
        .form-container label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
            color: #333;
        }
        .form-container input,
        .form-container select,
        .form-container textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-container textarea {
            min-height: 100px;
            resize: vertical;
        }
        .form-container button {
            background-color: #1A73E8;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .form-container button:hover {
            background-color: #1557B0;
        }
        .imagens-section {
            order: -1;
            margin-left: auto;
        }
        #imagensPreview {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .image-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .image-container img {
            max-width: 120px;
            max-height: 120px;
            border-radius: 4px;
            object-fit: cover;
        }
        .toggle-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .toggle-container label {
            margin: 0;
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
        }
        .toggle-container input[type="checkbox"] {
            margin-right: 5px;
        }
    </style>

    <script>
        // Carregar tipos do JSON
        fetch('tipos.json')
            .then(response => response.json())
            .then(tipos => {
                const select = document.getElementById('tipoSelect');
                tipos.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo;
                    option.textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1);
                    select.appendChild(option);
                });
            })
            .catch(error => console.error('Erro ao carregar tipos.json:', error));

        // Pré-visualização de imagens com toggles
        const imagensInput = document.getElementById('imagensInput');
        const imagensPreview = document.getElementById('imagensPreview');

        console.log('Script carregado. Elemento imagensInput encontrado:', imagensInput);
        console.log('Elemento imagensPreview encontrado:', imagensPreview);

        imagensInput.addEventListener('change', function(e) {
            console.log('Evento change disparado no input de imagens');
            imagensPreview.innerHTML = ''; // Limpa a prévia anterior
            const files = e.target.files;

            console.log('Arquivos selecionados:', files);

            if (!files || files.length === 0) {
                console.log('Nenhum arquivo selecionado.');
                return;
            }

            Array.from(files).forEach((file, i) => {
                console.log(`Processando arquivo ${i + 1}: ${file.name}`);
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        console.log(`Imagem ${i + 1} carregada com sucesso`);
                        const div = document.createElement('div');
                        div.className = 'image-container';

                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = `Prévia da imagem ${i + 1}`;
                        div.appendChild(img);

                        const toggleDiv = document.createElement('div');
                        toggleDiv.className = 'toggle-container';
                        toggleDiv.innerHTML = `
                            <label><input type="checkbox" name="imagens[${i}][livre]"> Livre</label>
                            <label><input type="checkbox" name="imagens[${i}][afiliados]"> Afiliados</label>
                            <label><input type="checkbox" name="imagens[${i}][privado]"> Privado Compradores</label>
                        `;
                        div.appendChild(toggleDiv);

                        imagensPreview.appendChild(div);
                        console.log(`Imagem ${i + 1} adicionada ao preview`);
                    };

                    reader.onerror = function() {
                        console.error(`Erro ao ler o arquivo ${file.name}`);
                    };

                    reader.readAsDataURL(file);
                } else {
                    console.warn(`Arquivo ${file.name} não é uma imagem.`);
                }
            });
        });

        function enviarCadastroImovel(event) {
            event.preventDefault();
            const formData = new FormData();
            const elements = document.querySelectorAll('.imovel-cadastro input, .imovel-cadastro select, .imovel-cadastro textarea');
            elements.forEach(element => {
                if (element.name === 'imagens') {
                    for (let file of element.files) {
                        formData.append('imagens', file);
                    }
                } else {
                    formData.append(element.name, element.value);
                }
            });

            const toggles = document.querySelectorAll('.toggle-container input[type="checkbox"]:checked');
            toggles.forEach(toggle => {
                const nameParts = toggle.name.match(/imagens\[(\d+)\]\[(livre|afiliados|privado)\]/);
                if (nameParts) {
                    const index = nameParts[1];
                    const status = nameParts[2];
                    formData.append(`imagens[${index}][${status}]`, toggle.checked);
                }
            });

            console.log('Formulário enviado:', Object.fromEntries(formData));
            alert('Cadastro enviado! Implemente a lógica no seu código existente.');
        }
    </script>
</div>